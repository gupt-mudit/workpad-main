!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports["@otjs/state-machine"]=e():t["@otjs/state-machine"]=e()}(this,(function(){return function(){"use strict";var t={d:function(e,n){for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})},o:function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r:function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{StateMachine:function(){return c}});var n,r,o=(n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},n(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),i=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Assertion Failed",e}return o(e,t),e}(Error),p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="No-op Encountered",e.message="This method should not have been called!",e}return o(e,t),e}(Error);function s(t,e){if(null==t||!1===t)throw"string"==typeof e?new i(e):e}r=Error,o((function(){var t=null!==r&&r.apply(this,arguments)||this;return t.name="Invalid Operation Encountered",t.message="The Operation recieved was either Invalid or Corrupted, please retry!",t}),r),function(t){o((function(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Transaction Failure",e.message="Failed to update in the Database",e}),t)}(Error),function(t){o((function(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="DOM Operation Failure",e.message="Failed to Query or Mutate some DOM Node",e}),t)}(Error);var u=function(){function t(t,e){this._outstanding=t,this._buffer=e}return t.prototype.isSynchronized=function(){return!1},t.prototype.isAwaitingConfirm=function(){return!1},t.prototype.isAwaitingWithBuffer=function(){return!0},t.prototype.applyClient=function(e,n){var r=this._buffer.compose(n);return new t(this._outstanding,r)},t.prototype.applyServer=function(e,n){var r=this._outstanding.transform(n),o=this._buffer.transform(r[1]);return e.applyOperation(o[1]),new t(r[0],o[0])},t.prototype.serverAck=function(t){return t.sendOperation(this._buffer),new a(this._buffer)},t.prototype.serverRetry=function(t){var e=this._outstanding.compose(this._buffer);return t.sendOperation(e),new a(e)},t}(),a=function(){function t(t){this._outstanding=t}return t.prototype.isSynchronized=function(){return!1},t.prototype.isAwaitingConfirm=function(){return!0},t.prototype.isAwaitingWithBuffer=function(){return!1},t.prototype.applyClient=function(t,e){return new u(this._outstanding,e)},t.prototype.applyServer=function(e,n){var r=this._outstanding.transform(n);return e.applyOperation(r[1]),new t(r[0])},t.prototype.serverAck=function(t){return f},t.prototype.serverRetry=function(t){return t.sendOperation(this._outstanding),this},t}(),f=new(function(){function t(){}return t.prototype.isSynchronized=function(){return!0},t.prototype.isAwaitingConfirm=function(){return!1},t.prototype.isAwaitingWithBuffer=function(){return!1},t.prototype.applyClient=function(t,e){return t.sendOperation(e),new a(e)},t.prototype.applyServer=function(t,e){return t.applyOperation(e),this},t.prototype.serverAck=function(t){throw new p},t.prototype.serverRetry=function(t){throw new p},t}()),c=function(){function t(t){this._state=f,this._handler=t}return t.prototype.dispose=function(){this._handler=null},t.prototype.isSynchronized=function(){return this._state.isSynchronized()},t.prototype.isAwaitingConfirm=function(){return this._state.isAwaitingConfirm()},t.prototype.isAwaitingWithBuffer=function(){return this._state.isAwaitingWithBuffer()},t.prototype._setState=function(t){this._state=t},t.prototype.applyClient=function(t){this._setState(this._state.applyClient(this,t))},t.prototype.applyServer=function(t){this._setState(this._state.applyServer(this,t))},t.prototype.serverAck=function(){this._setState(this._state.serverAck(this))},t.prototype.serverRetry=function(){this._setState(this._state.serverRetry(this))},t.prototype.applyOperation=function(t){s(null!=this._handler,new p("Can not call `applyOperation` after state machine have been disposed!")),this._handler.applyOperation(t)},t.prototype.sendOperation=function(t){s(null!=this._handler,new p("Can not call `sendOperation` after state machine have been disposed!")),this._handler.sendOperation(t)},t}();return e}()}));
//# sourceMappingURL=index.js.map